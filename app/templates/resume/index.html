{% extends "base.html" %}

{% block head %}
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="resume-wrapper">
    <div class="container resume-section py-4">
        <div id="resume-content" class="resume-loading">
            <div class="loading-spinner">
                <div class="spinner-grow text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    fetch('/resume/api/data')
        .then(response => response.json())
        .then(data => {
            const resumeContent = document.getElementById('resume-content');
            resumeContent.innerHTML = `
                <div class="print-content">
                    <div class="resume-header text-center mb-4" data-aos="fade-down">
                        <h1 class="mb-3">${data.header}</h1>
                        <div class="contact-info">
                            ${data.contact.split('\n').map(line => {
                                // Check if this line is part of an address
                                const isStreet = !line.includes('@') && !line.includes('github') && !line.includes('linkedin') && !line.includes(',');
                                const isCity = line.includes(',');
                                
                                // Skip the street line as we'll combine it with the city
                                if (isStreet) return '';
                                
                                // If it's a city line, combine it with the previous street address
                                if (isCity) {
                                    const street = data.contact.split('\n').find(l => !l.includes('@') && !l.includes('github') && !l.includes('linkedin') && !l.includes(','));
                                    return `
                                        <div class="contact-item">
                                            <i class="fas fa-map-marker-alt me-2"></i>
                                            <span>${street}, ${line}</span>
                                        </div>
                                    `;
                                }
                                
                                // For other contact info (email, github, linkedin)
                                return `
                                    <div class="contact-item">
                                        ${line.includes('@') ? `<i class="fas fa-envelope me-2"></i>` : 
                                          line.includes('github') ? `<i class="fab fa-github me-2"></i>` : 
                                          line.includes('linkedin') ? `<i class="fab fa-linkedin me-2"></i>` : 
                                          `<i class="fas fa-map-marker-alt me-2"></i>`}
                                        <span>${line}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <div class="resume-body">
                        ${data.sections.map((section, index) => `
                            <div class="section mb-4" data-aos="fade-up" data-aos-delay="${index * 100}">
                                <h2 class="section-header">
                                    <i class="fas ${
                                        section.title.toLowerCase().includes('education') ? 'fa-graduation-cap' :
                                        section.title.toLowerCase().includes('experience') ? 'fa-briefcase' :
                                        section.title.toLowerCase().includes('skills') ? 'fa-tools' :
                                        section.title.toLowerCase().includes('projects') ? 'fa-code-branch' :
                                        'fa-star'
                                    } me-2"></i>
                                    ${section.title}
                                </h2>
                                <div class="section-content">
                                    ${section.content.map(line => {
                                        if (line.startsWith('-')) {
                                            return `<div class="content-item bold-line">${line.substring(1)}</div>`;
                                        }
                                        if (line.includes('GPA') && line.toUpperCase() === line) {
                                            return `<div class="content-item gpa-line">${line}</div>`;
                                        }
                                        return `<div class="content-item">${line}</div>`;
                                    }).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            resumeContent.classList.remove('resume-loading');
            resumeContent.classList.add('resume-loaded');

            // Initialize AOS
            AOS.init({
                duration: 800,
                once: true,
                offset: 50
            });
        })
        .catch(error => {
            console.error('Error:', error);
            const resumeContent = document.getElementById('resume-content');
            resumeContent.innerHTML = `
                <div class="alert alert-danger" role="alert">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    Failed to load resume data. Please try again later.
                </div>
            `;
            resumeContent.classList.remove('resume-loading');
        });
});
</script>

<style>
/* Base styles */
.resume-wrapper {
    background-color: #f8f9fa;
    min-height: calc(100vh - var(--navbar-height));
    padding: 2rem 0;
}

.resume-section {
    max-width: 900px;
    margin: 0 auto;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 2rem;
}

/* Loading state */
.resume-loading {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 300px;
}

.loading-spinner {
    text-align: center;
}

.resume-loaded {
    opacity: 0;
    animation: fadeIn 0.5s ease forwards;
}

@keyframes fadeIn {
    to {
        opacity: 1;
    }
}

/* Content styles */
.print-content {
    width: 100%;
}

.resume-header h1 {
    font-size: 2.5rem;
    font-weight: 600;
    color: #333;
}

.contact-info {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 1rem;
    margin: 1.5rem 0;
}

.contact-item {
    display: flex;
    align-items: center;
    padding: 0.5rem 1rem;
    background-color: #f8f9fa;
    border-radius: 8px;
    font-size: 1rem;
    color: #666;
}

.contact-item i {
    color: #0d6efd;
}

/* Section styles */
.section {
    margin-bottom: 2.5rem;
    break-inside: avoid;
}

.section-header {
    display: flex;
    align-items: center;
    font-size: 1.75rem;
    font-weight: 600;
    color: #333;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #333;
}

.section-header i {
    color: #0d6efd;
}

.section-content {
    padding: 0 0.5rem;
}

.content-item {
    margin-bottom: 1rem;
    line-height: 1.6;
    color: #555;
}

.content-item p {
    margin-bottom: 1.5rem;
}

.content-item ul {
    margin-bottom: 2rem;
    padding-left: 1.5rem;
}

.content-item li {
    margin-bottom: 0.5rem;
}

.content-item + .content-item {
    margin-top: 2rem;
}

.section-break {
    margin: 2.5rem 0;
    border-top: 1px solid #eee;
}

.bold-line {
    font-weight: 600;
    color: #444;
}

.gpa-line {
    font-weight: 500;
    color: #666;
    font-style: italic;
}

/* Print styles */
@media print {
    body {
        margin: 0;
        padding: 0;
        background: white;
    }

    .resume-wrapper {
        background: none;
        padding: 0;
        min-height: auto;
    }

    .resume-section {
        box-shadow: none;
        padding: 0;
        margin: 0;
        max-width: none;
        background: none;
    }

    .section {
        page-break-inside: avoid;
        margin-bottom: 1.5rem;
    }

    .contact-info {
        gap: 0.75rem;
    }

    .contact-item {
        background: none;
        padding: 0.25rem;
        color: black !important;
    }

    .contact-item i {
        color: black !important;
    }

    .section-header {
        color: black !important;
        border-bottom-color: black !important;
    }

    .section-header i {
        color: black !important;
    }

    .content-item {
        color: black !important;
    }

    /* Remove animations and transitions */
    * {
        animation: none !important;
        transition: none !important;
    }
}

/* Mobile Styles */
@media (max-width: 768px) {
    .resume-wrapper {
        padding: 1rem 0;
    }

    .resume-section {
        padding: 1.5rem;
        margin: 0 1rem;
        border-radius: 16px;
    }

    .resume-header h1 {
        font-size: 2rem;
    }

    .contact-info {
        flex-direction: column;
        align-items: stretch;
        gap: 0.5rem;
    }

    .contact-item {
        justify-content: flex-start;
        padding: 0.75rem;
    }

    .section-header {
        font-size: 1.4rem;
    }

    .content-item {
        font-size: 0.95rem;
        line-height: 1.5;
    }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
    .resume-wrapper {
        background-color: #1a1a1a;
    }

    .resume-section {
        background-color: #2d2d2d;
    }

    .resume-header h1 {
        color: #e0e0e0;
    }

    .contact-item {
        background-color: #333;
        color: #b0b0b0;
    }

    .section-header {
        color: #e0e0e0;
        border-bottom-color: #666;
    }

    .content-item {
        color: #b0b0b0;
    }

    .bold-line {
        color: #d0d0d0;
    }

    .gpa-line {
        color: #b0b0b0;
    }
}

/* Safe area insets for modern mobile devices */
@supports(padding: max(0px)) {
    .resume-wrapper {
        padding-left: max(1rem, env(safe-area-inset-left));
        padding-right: max(1rem, env(safe-area-inset-right));
        padding-bottom: max(1rem, env(safe-area-inset-bottom));
    }
}
</style>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
{% endblock %}
